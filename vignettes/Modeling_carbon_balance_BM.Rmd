---
title: "Modeling_carbon_balance"
author: "Joseph R. Stinziano"
date: "`r Sys.Date()"
output: html_document
vignette: >
 %\VignetteIndexEntry{Using_plantecophystools}
 %\VignetteEngine{knitr::rmarkdown}
 %\VignetteEncoding{UTF-8}
---

```{r}
library(arrhenius.comparison)
library(dplyr)
```

```{r include = FALSE}
#Data below is from Stinziano & Way, 2017
#Week 1 biomass was 2.49 g
#Week 12 biomass was 12.68 g
#Stem biomass is 0.199 * total
#RMR was 0.2 * total at week 1, and 0.4 * total at week 12
#LMA was 100 g/m at week 1, 200 g/m at week 12
leaf_area_1 <- 2.49 * (1 - 0.399) / 100
leaf_area_12 <- 12.68 * (1 - 0.599) / 200
stem_mass_1 <- 2.49 * 0.199
stem_mass_12 <- 12.68 * 0.199
root_mass_1 <- 2.49 * 0.2
root_mass_12 <- 12.68 * 0.4

```
Basically need to run week 1 and week 2 code for environmental data and compile
Note that the output will include a sum across all the environmental data in the
input file. We will need to add descriptors for each day and then sum by day. As
long as DOY is specified in the environment data, we will be able to do this
easily since calculate_photo binds the environmental data to the physiology data.

#Hd = 200 kJ mol-1
#Week 1 modeling - low root/leaf ratio
#Remove octothorpe below to run chunk
```{r include = FALSE}
data_env <- read.csv(system.file("extdata", "env_data.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_v <- read.csv(system.file("extdata", "fits_v_2.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_j <- read.csv(system.file("extdata", "fits_j_2.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)

pars_v <- pars_v[pars_v$Hd == 200,]
pars_j <- pars_v[pars_j$Hd == 200,]

#these lines were used to manually pare down
#and match up the vcmax and jmax data
#diffs <- cbind(pars_v$ID, pars_j$ID, pars_v$Hd, pars_j$Hd)
#colnames(diffs) <- c("V", "J", "V", "J")

data_phys <- list(NULL)
#Basically, we need a solid set of respiration data
data_r <- calculate_r(data = data_env,
                      leaf_Q10_day = 2.015, #Atkin & Tjoelker 2003, 25C acclimated
                      leaf_Q10_night = 2.015,
                      root_Q10 = 2.015,
                      shoot_Q10 = 2.015,
                      leaf_k25_day = 2.78 * 0.7, #Assumption from Stinziano et al. 2019
                      leaf_k25_night = 2.78, #Resp from control in Stinziano & Way 2017
                      root_k25 = 0.0095,#Weger and Guy 1991
                      shoot_k25 = 0.0095,#Assume stem and root respiration rates are similar
                      leaf_area = leaf_area_1,
                      root_mass = root_mass_1,
                      shoot_mass = stem_mass_1)
data_r <- data_r[, 1:7] #remove temperature column - poses issue later
for(i in 1:nrow(pars_v)){
data_p <- calculate_p(G25 = 42.75, #Bernacchi et al. 2001
                      G_Ea = 37.830, #Bernacchi et al. 2001
                      Km25 = 718.40, #Bernacchi et al. 2001
                      Km_Ea = 65.50828, #Bernacchi et al. 2001
                      Temp = data_env$Temp,
                      Vcmax25_m = pars_v$k25_o[i],
                      Vcmax_dS_m = pars_v$dS_o[i],
                      Vcmax_Hd_m = pars_v$Hd_o[i],
                      Vcmax_Ea_m = pars_v$Ea_o[i],
                      Vcmax25_n = pars_v$k25[i],
                      Vcmax_dS_n = pars_v$dS[i],
                      Vcmax_Hd_n = pars_v$Hd[i],
                      Vcmax_Ea_n = pars_v$Ea[i],
                      Jmax25_m = pars_j$k25_o[i],
                      Jmax_dS_m = pars_j$dS_o[i],
                      Jmax_Hd_m = pars_j$Hd_o[i],
                      Jmax_Ea_m = pars_j$Ea_o[i],
                      Jmax25_n = pars_j$k25[i],
                      Jmax_dS_n = pars_j$dS[i],
                      Jmax_Hd_n = pars_j$Hd[i],
                      Jmax_Ea_n = pars_j$Ea[i])
data_p <- data_p[, 1:6] #Removes temp column to preclude issues later
data_phys[[i]] <- cbind(data_r, data_p)
}

#Model with Medlyn equation
modelled <- list(NULL)
for(i in 1:length(data_phys)){
modelled[[i]] <- calculate_photo(data_phys = data_phys[[i]],
                            data_env = data_env,
                            varnames = list(GammaStar = "GammaStar",
                                            Jmax = "Jmax_medlyn",
                                            Km = "Km",
                                            leaf_respiration = "leaf_respiration",
                                            root_respiration = "root_respiration",
                                            shoot_respiration = "shoot_respiration",
                                            total_respiration_plant = "total_respiration_plant",
                                            Ca = "Ca",
                                            Qin = "Qin",
                                            VPD = "VPD",
                                            Temp = "Temp",
                                            Vcmax = "Vcmax_medlyn"),
                            leaf_area = leaf_area_1,
                            phi = 0.08, #Campbell & Norman 1998
                            time_step = 3600) #3600 s/hr
}

for(i in 1:length(modelled)){
  modelled[[i]][[1]]$ID <- "Medlyn"
}

ge <- list(NULL)
for(i in 1:length(modelled)){
  ge[[i]] <- modelled[[i]][[1]]
}

ge <- do.call("rbind", ge)

dailyC <- list(NULL)
for(i in 1:length(modelled)){
  dailyC[[i]] <- modelled[[i]][[1]] %>% 
    group_by(DOY, Location) %>% 
    summarize(daily_plant_C = sum(A_net_plant * 3600) * 12.01 / 1000000, #12.01 g/mol, umol to mol
              daily_plant_photosynthesis = sum(A_gross_plant * 3600) * 12.01 / 1000000,
              daily_plant_respiration = sum(total_respiration_plant * 3600) * 12.01 / 1000000)
  dailyC[[i]]$ID <- "Medlyn"
}
dailyC <- do.call("rbind", dailyC)

#Model with rederivation
modelled2 <- list(NULL)
for(i in 1:length(data_phys)){
modelled2[[i]] <- calculate_photo(data_phys = data_phys[[i]],
                            data_env = data_env,
                            varnames = list(GammaStar = "GammaStar",
                                            Jmax = "Jmax_new",
                                            Km = "Km",
                                            leaf_respiration = "leaf_respiration",
                                            root_respiration = "root_respiration",
                                            shoot_respiration = "shoot_respiration",
                                            total_respiration_plant = "total_respiration_plant",
                                            Ca = "Ca",
                                            Qin = "Qin",
                                            VPD = "VPD",
                                            Temp = "Temp",
                                            Vcmax = "Vcmax_new"),
                            leaf_area = leaf_area_1,
                            phi = 0.08,
                            time_step = 3600)
}

for(i in 1:length(modelled2)){
  modelled2[[i]][[1]]$ID <- "New"
}

ge2 <- list(NULL)
for(i in 1:length(modelled2)){
  ge2[[i]] <- modelled2[[i]][[1]]
}

ge2 <- do.call("rbind", ge2)

dailyC2 <- list(NULL)
for(i in 1:length(modelled2)){
  dailyC2[[i]] <- modelled2[[i]][[1]] %>% 
    group_by(DOY, Location) %>% 
    summarize(daily_plant_C = sum(A_net_plant * 3600) * 12.01 / 1000000,
              daily_plant_photosynthesis = sum(A_gross_plant * 3600) * 12.01 / 1000000,
              daily_plant_respiration = sum(total_respiration_plant * 3600) * 12.01 / 1000000)
  dailyC2[[i]]$ID <- "New"
}
dailyC2 <- do.call("rbind", dailyC2)

week_1_carbon_Hd200 <- rbind(dailyC, dailyC2)
week_1_ge <- rbind(ge, ge2)
boxplot(daily_plant_C ~ ID, data = week_1_carbon_Hd200)
summary(lm(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_C ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_C-1)) #0.03% underestimation
lm(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_C ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_C)
```

#Statistics and graphical output for Week 1 (Hd = 200 kJ mol-1)
#Remove octothorpe below to run chunk
```{r include = FALSE}
#Additional column for daily plant A/R
week_1_carbon_Hd200$daily_plant_AR <- (week_1_carbon_Hd200$daily_plant_photosynthesis/week_1_carbon_Hd200$daily_plant_respiration)
week_1_carbon_Hd200$daily_plant_AR

#Stats
summary(lm(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_C ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_C))

summary(lm(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_photosynthesis ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_photosynthesis))

summary(lm(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_AR ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_AR))

#Basic Graphs
plot(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_C ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_C,
  xlab="New Total Daily C Gain", ylab="Old Total Daily C Gain", main="a) Week 1 using Hd Fit 200 kJ")
abline(lm(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_C ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_C), col="blue")

plot(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_photosynthesis ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_photosynthesis,
  xlab="New Total Daily Photosynthesis", ylab="Old Total Daily Photosynthesis", main="c) Week 1 using Hd Fit 200 kJ")
abline(lm(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_photosynthesis ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_photosynthesis), col="blue")

plot(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_AR ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_AR,
  xlab="New Total Daily A/R", ylab="Old Total Daily A/R", main="e) Week 1 using Hd Fit 200 kJ")
abline(lm(week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "New",]$daily_plant_AR ~ week_1_carbon_Hd200[week_1_carbon_Hd200$ID == "Medlyn",]$daily_plant_AR), col="blue")
```

#Week 12 modeling - high root/leaf ratio
#Remove octothorpe below to run chunk
```{r include = FALSE}
data <- read.csv(system.file("extdata", "env_data.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_v <- read.csv(system.file("extdata", "fits_v_2.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_j <- read.csv(system.file("extdata", "fits_j_2.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_v <- pars_v[pars_v$Hd == 200,]
pars_j <- pars_v[pars_j$Hd == 200,]
data_phys <- list(NULL)
#Basically, we need a solid set of respiration data
data_r <- calculate_r(data = data,
                      leaf_Q10_day = 2.015,
                      leaf_Q10_night = 2.015,
                      root_Q10 = 2.015,
                      shoot_Q10 = 2.015,
                      leaf_k25_day = 2.78 * 0.7,
                      leaf_k25_night = 2.78,
                      root_k25 = 0.0095,#Weger and Guy 1991
                      shoot_k25 = 0.0095,#Assume stem and root respiration rates are similar
                      leaf_area = leaf_area_12,
                      root_mass = root_mass_12,
                      shoot_mass = stem_mass_12)
data_r <- data_r[, 1:7] #remove temperature column - poses issue later
for(i in 1:nrow(pars_v)){
data_p <- calculate_p(G25 = 42.75,
                      G_Ea = 37.830,
                      Km25 = 718.40,
                      Km_Ea = 65.50828,
                      Temp = data$Temp,
                      Vcmax25_m = pars_v$k25_o[i],
                      Vcmax_dS_m = pars_v$dS_o[i],
                      Vcmax_Hd_m = pars_v$Hd_o[i],
                      Vcmax_Ea_m = pars_v$Ea_o[i],
                      Vcmax25_n = pars_v$k25[i],
                      Vcmax_dS_n = pars_v$dS[i],
                      Vcmax_Hd_n = pars_v$Hd[i],
                      Vcmax_Ea_n = pars_v$Ea[i],
                      Jmax25_m = pars_j$k25_o[i],
                      Jmax_dS_m = pars_j$dS_o[i],
                      Jmax_Hd_m = pars_j$Hd_o[i],
                      Jmax_Ea_m = pars_j$Ea_o[i],
                      Jmax25_n = pars_j$k25[i],
                      Jmax_dS_n = pars_j$dS[i],
                      Jmax_Hd_n = pars_j$Hd[i],
                      Jmax_Ea_n = pars_j$Ea[i])
data_p <- data_p[, 1:6] #Removes temp column to preclude issues later
data_phys[[i]] <- cbind(data_r, data_p)
}

modelled <- list(NULL)
for(i in 1:length(data_phys)){
modelled[[i]] <- calculate_photo(data_phys = data_phys[[i]],
                            data_env = data,
                            varnames = list(GammaStar = "GammaStar",
                                            Jmax = "Jmax_medlyn",
                                            Km = "Km",
                                            leaf_respiration = "leaf_respiration",
                                            root_respiration = "root_respiration",
                                            shoot_respiration = "shoot_respiration",
                                            total_respiration_plant = "total_respiration_plant",
                                            Ca = "Ca",
                                            Qin = "Qin",
                                            VPD = "VPD",
                                            Temp = "Temp",
                                            Vcmax = "Vcmax_medlyn"),
                            leaf_area = leaf_area_12,
                            phi = 0.08,
                            time_step = 3600)
}

#Note, we will need a for loop that looks like this:
for(i in 1:length(modelled)){
  modelled[[i]][[1]]$ID <- "Medlyn"
}

ge <- list(NULL)
for(i in 1:length(modelled)){
  ge[[i]] <- modelled[[i]][[1]]
}

ge <- do.call("rbind", ge)

dailyC <- list(NULL)
for(i in 1:length(modelled)){
  dailyC[[i]] <- modelled[[i]][[1]] %>% 
    group_by(DOY, Location) %>% 
    summarize(daily_plant_C = sum(A_net_plant * 3600) * 12.01 / 1000000,
              daily_plant_photosynthesis = sum(A_gross_plant * 3600) * 12.01 / 1000000,
              daily_plant_respiration = sum(total_respiration_plant * 3600) * 12.01 / 1000000)
  dailyC[[i]]$ID <- "Medlyn"
}
dailyC <- do.call("rbind", dailyC)

modelled2 <- list(NULL)
for(i in 1:length(data_phys)){
modelled2[[i]] <- calculate_photo(data_phys = data_phys[[i]],
                            data_env = data,
                            varnames = list(GammaStar = "GammaStar",
                                            Jmax = "Jmax_new",
                                            Km = "Km",
                                            leaf_respiration = "leaf_respiration",
                                            root_respiration = "root_respiration",
                                            shoot_respiration = "shoot_respiration",
                                            total_respiration_plant = "total_respiration_plant",
                                            Ca = "Ca",
                                            Qin = "Qin",
                                            VPD = "VPD",
                                            Temp = "Temp",
                                            Vcmax = "Vcmax_new"),
                            leaf_area = leaf_area_12,
                            phi = 0.08,
                            time_step = 3600)
}
#Note, we will need a for loop that looks like this:
for(i in 1:length(modelled2)){
  modelled2[[i]][[1]]$ID <- "New"
}

ge2 <- list(NULL)
for(i in 1:length(modelled2)){
  ge2[[i]] <- modelled2[[i]][[1]]
}

ge2 <- do.call("rbind", ge2)

dailyC2 <- list(NULL)
for(i in 1:length(modelled2)){
  dailyC2[[i]] <- modelled2[[i]][[1]] %>% 
    group_by(DOY, Location) %>% 
    summarize(daily_plant_C = sum(A_net_plant * 3600) * 12.01 / 1000000,
              daily_plant_photosynthesis = sum(A_gross_plant * 3600) * 12.01 / 1000000,
              daily_plant_respiration = sum(total_respiration_plant * 3600) * 12.01 / 1000000)
  dailyC2[[i]]$ID <- "New"
}
dailyC2 <- do.call("rbind", dailyC2)

week_12_carbon_Hd200 <- rbind(dailyC, dailyC2)
week_12_ge <- rbind(ge, ge2)
boxplot(daily_plant_C ~ ID, data = week_12_carbon_Hd200)
summary(lm(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_C ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_C-1)) #0.03% underestimation
lm(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_C ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_C)
```

#Statistics and graphical output for Week 12 (Hd = 200 kJ mol-1)
#Remove octothorpe below to run chunk
```{r include = FALSE}
# Additional column for daily plant A/R
week_12_carbon_Hd200$daily_plant_AR <- (week_12_carbon_Hd200$daily_plant_photosynthesis/week_12_carbon_Hd200$daily_plant_respiration)
week_12_carbon_Hd200$daily_plant_AR

#Stats
summary(lm(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_C ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_C))

summary(lm(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_photosynthesis ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_photosynthesis))

summary(lm(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_AR ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_AR))

#Basic Graphs
plot(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_C ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_C,
  xlab="New Total Daily C Gain", ylab="Old Total Daily C Gain", main="b) Week 12 using Hd Fit 200 kJ")
abline(lm(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_C ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_C), col="blue")

plot(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_photosynthesis ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_photosynthesis,
  xlab="New Total Daily Photosynthesis", ylab="Old Total Daily Photosynthesis", main="d) Week 12 using Hd Fit 200 kJ")
abline(lm(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_photosynthesis ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_photosynthesis), col="blue")

plot(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_AR ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_AR,
  xlab="New Total Daily A/R", ylab="Old Total Daily A/R", main="f) Week 12 using Hd Fit 200 kJ")
abline(lm(week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "New",]$daily_plant_AR ~ week_12_carbon_Hd200[week_12_carbon_Hd200$ID == "Medlyn",]$daily_plant_AR), col="blue")
```

Merge both datasets and output
#Remove octothorpe below to run chunk
```{r include = FALSE}
carbon <- rbind(week_1_carbon, week_12_carbon)
gasex <- rbind(week_1_ge, week_12_ge)
write.csv(carbon, "carbon_Hd200.csv")
write.csv(gasex, "gasex_Hd200.csv")
```

#Hd = fitted
#Week 1 modeling - low root/leaf ratio
#Remove octothorpe below to run chunk
```{r include = FALSE}
data_env <- read.csv(system.file("extdata", "env_data.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_v <- read.csv(system.file("extdata", "fits_v_2.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_j <- read.csv(system.file("extdata", "fits_j_2.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_v <- pars_v[pars_v$Hd != 200,]
pars_j <- pars_v[pars_j$Hd != 200,]
data_phys <- list(NULL)
#Basically, we need a solid set of respiration data
data_r <- calculate_r(data = data_env,
                      leaf_Q10_day = 2.015, #Atkin & Tjoelker 2003, 25C acclimated
                      leaf_Q10_night = 2.015,
                      root_Q10 = 2.015,
                      shoot_Q10 = 2.015,
                      leaf_k25_day = 2.78 * 0.7, #Assumption from Stinziano et al. 2019
                      leaf_k25_night = 2.78, #Resp from control in Stinziano & Way 2017
                      root_k25 = 0.0095,#Weger and Guy 1991
                      shoot_k25 = 0.0095,#Assume stem and root respiration rates are similar
                      leaf_area = leaf_area_1,
                      root_mass = root_mass_1,
                      shoot_mass = stem_mass_1)
data_r <- data_r[, 1:7] #remove temperature column - poses issue later
for(i in 1:nrow(pars_v)){
data_p <- calculate_p(G25 = 42.75, #Bernacchi et al. 2001
                      G_Ea = 37.830, #Bernacchi et al. 2001
                      Km25 = 718.40, #Bernacchi et al. 2001
                      Km_Ea = 65.50828, #Bernacchi et al. 2001
                      Temp = data_env$Temp,
                      Vcmax25_m = pars_v$k25_o[i],
                      Vcmax_dS_m = pars_v$dS_o[i],
                      Vcmax_Hd_m = pars_v$Hd_o[i],
                      Vcmax_Ea_m = pars_v$Ea_o[i],
                      Vcmax25_n = pars_v$k25[i],
                      Vcmax_dS_n = pars_v$dS[i],
                      Vcmax_Hd_n = pars_v$Hd[i],
                      Vcmax_Ea_n = pars_v$Ea[i],
                      Jmax25_m = pars_j$k25_o[i],
                      Jmax_dS_m = pars_j$dS_o[i],
                      Jmax_Hd_m = pars_j$Hd_o[i],
                      Jmax_Ea_m = pars_j$Ea_o[i],
                      Jmax25_n = pars_j$k25[i],
                      Jmax_dS_n = pars_j$dS[i],
                      Jmax_Hd_n = pars_j$Hd[i],
                      Jmax_Ea_n = pars_j$Ea[i])
data_p <- data_p[, 1:6] #Removes temp column to preclude issues later
data_phys[[i]] <- cbind(data_r, data_p)
}

#Model with Medlyn equation
modelled <- list(NULL)
for(i in 1:length(data_phys)){
modelled[[i]] <- calculate_photo(data_phys = data_phys[[i]],
                            data_env = data_env,
                            varnames = list(GammaStar = "GammaStar",
                                            Jmax = "Jmax_medlyn",
                                            Km = "Km",
                                            leaf_respiration = "leaf_respiration",
                                            root_respiration = "root_respiration",
                                            shoot_respiration = "shoot_respiration",
                                            total_respiration_plant = "total_respiration_plant",
                                            Ca = "Ca",
                                            Qin = "Qin",
                                            VPD = "VPD",
                                            Temp = "Temp",
                                            Vcmax = "Vcmax_medlyn"),
                            leaf_area = leaf_area_1,
                            #phi = 0.08, #Campbell & Norman 1998
                            phi = 0.85, #CLM 5.0
                            time_step = 3600) #3600 s/hr
}

for(i in 1:length(modelled)){
  modelled[[i]][[1]]$ID <- "Medlyn"
}

ge <- list(NULL)
for(i in 1:length(modelled)){
  ge[[i]] <- modelled[[i]][[1]]
}

ge <- do.call("rbind", ge)

dailyC <- list(NULL)
for(i in 1:length(modelled)){
  dailyC[[i]] <- modelled[[i]][[1]] %>% 
    group_by(DOY, Location) %>% 
    summarize(daily_plant_C = sum(A_net_plant * 3600) * 12.01 / 1000000, #12.01 g/mol, umol to mol
              daily_plant_photosynthesis = sum(A_gross_plant * 3600) * 12.01 / 1000000,
              daily_plant_respiration = sum(total_respiration_plant * 3600) * 12.01 / 1000000)
  dailyC[[i]]$ID <- "Medlyn"
}
dailyC <- do.call("rbind", dailyC)

#Model with rederivation
modelled2 <- list(NULL)
for(i in 1:length(data_phys)){
modelled2[[i]] <- calculate_photo(data_phys = data_phys[[i]],
                            data_env = data_env,
                            varnames = list(GammaStar = "GammaStar",
                                            Jmax = "Jmax_new",
                                            Km = "Km",
                                            leaf_respiration = "leaf_respiration",
                                            root_respiration = "root_respiration",
                                            shoot_respiration = "shoot_respiration",
                                            total_respiration_plant = "total_respiration_plant",
                                            Ca = "Ca",
                                            Qin = "Qin",
                                            VPD = "VPD",
                                            Temp = "Temp",
                                            Vcmax = "Vcmax_new"),
                            leaf_area = leaf_area_1,
                            phi = 0.08,
                            time_step = 3600)
}

for(i in 1:length(modelled2)){
  modelled2[[i]][[1]]$ID <- "New"
}

ge2 <- list(NULL)
for(i in 1:length(modelled2)){
  ge2[[i]] <- modelled2[[i]][[1]]
}

ge2 <- do.call("rbind", ge2)

dailyC2 <- list(NULL)
for(i in 1:length(modelled2)){
  dailyC2[[i]] <- modelled2[[i]][[1]] %>% 
    group_by(DOY, Location) %>% 
    summarize(daily_plant_C = sum(A_net_plant * 3600) * 12.01 / 1000000,
              daily_plant_photosynthesis = sum(A_gross_plant * 3600) * 12.01 / 1000000,
              daily_plant_respiration = sum(total_respiration_plant * 3600) * 12.01 / 1000000)
  dailyC2[[i]]$ID <- "New"
}
dailyC2 <- do.call("rbind", dailyC2)

week_1_carbon_Hdfit <- rbind(dailyC, dailyC2)
week_1_ge <- rbind(ge, ge2)

boxplot(daily_plant_C ~ ID, data = week_1_carbon_Hdfit)
summary(lm(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_C ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_C-1)) #0.1% underestimation
lm(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_C ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_C)
```

#Statistics and graphical output for Week 1 (Hd Fit)
#Remove octothorpe below to run chunk
#```{r include = FALSE}
# Additional column for daily plant A/R
week_1_carbon_Hdfit$daily_plant_AR <- (week_1_carbon_Hdfit$daily_plant_photosynthesis/week_1_carbon_Hdfit$daily_plant_respiration)
week_1_carbon_Hdfit$daily_plant_AR

#Stats
summary(lm(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_C ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_C))

summary(lm(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_photosynthesis ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_photosynthesis))

summary(lm(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_AR ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_AR))

#Basic Graphs
plot(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_C ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_C,
  xlab="New Total Daily C Gain", ylab="Old Total Daily C Gain", main="a) Week 1 using Hd Fit")
abline(lm(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_C ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_C), col="blue")

plot(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_photosynthesis ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_photosynthesis,
  xlab="New Total Daily Photosynthesis", ylab="Old Total Daily Photosynthesis", main="c) Week 1 using Hd Fit")
abline(lm(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_photosynthesis ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_photosynthesis), col="blue")

plot(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_AR ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_AR,
  xlab="New Total Daily A/R", ylab="Old Total Daily A/R", main="e) Week 1 using Hd Fit")
abline(lm(week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "New",]$daily_plant_AR ~ week_1_carbon_Hdfit[week_1_carbon_Hdfit$ID == "Medlyn",]$daily_plant_AR), col="blue")
```

#Week 12 modeling - high root/leaf ratio
#Remove octothorpe below to run chunk
#```{r include = FALSE}
data <- read.csv(system.file("extdata", "env_data.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_v <- read.csv(system.file("extdata", "fits_v_2.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_j <- read.csv(system.file("extdata", "fits_j_2.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
pars_v <- pars_v[pars_v$Hd != 200,]
pars_j <- pars_v[pars_j$Hd != 200,]
data_phys <- list(NULL)
#Basically, we need a solid set of respiration data
data_r <- calculate_r(data = data,
                      leaf_Q10_day = 2.015,
                      leaf_Q10_night = 2.015,
                      root_Q10 = 2.015,
                      shoot_Q10 = 2.015,
                      leaf_k25_day = 2.78 * 0.7,
                      leaf_k25_night = 2.78,
                      root_k25 = 0.0095,#Weger and Guy 1991
                      shoot_k25 = 0.0095,#Assume stem and root respiration rates are similar
                      leaf_area = leaf_area_12,
                      root_mass = root_mass_12,
                      shoot_mass = stem_mass_12)
data_r <- data_r[, 1:7] #remove temperature column - poses issue later
for(i in 1:nrow(pars_v)){
data_p <- calculate_p(G25 = 42.75,
                      G_Ea = 37.830,
                      Km25 = 718.40,
                      Km_Ea = 65.50828,
                      Temp = data$Temp,
                      Vcmax25_m = pars_v$k25_o[i],
                      Vcmax_dS_m = pars_v$dS_o[i],
                      Vcmax_Hd_m = pars_v$Hd_o[i],
                      Vcmax_Ea_m = pars_v$Ea_o[i],
                      Vcmax25_n = pars_v$k25[i],
                      Vcmax_dS_n = pars_v$dS[i],
                      Vcmax_Hd_n = pars_v$Hd[i],
                      Vcmax_Ea_n = pars_v$Ea[i],
                      Jmax25_m = pars_j$k25_o[i],
                      Jmax_dS_m = pars_j$dS_o[i],
                      Jmax_Hd_m = pars_j$Hd_o[i],
                      Jmax_Ea_m = pars_j$Ea_o[i],
                      Jmax25_n = pars_j$k25[i],
                      Jmax_dS_n = pars_j$dS[i],
                      Jmax_Hd_n = pars_j$Hd[i],
                      Jmax_Ea_n = pars_j$Ea[i])
data_p <- data_p[, 1:6] #Removes temp column to preclude issues later
data_phys[[i]] <- cbind(data_r, data_p)
data_phys
}

modelled <- list(NULL)
for(i in 1:length(data_phys)){
modelled[[i]] <- calculate_photo(data_phys = data_phys[[i]],
                            data_env = data,
                            varnames = list(GammaStar = "GammaStar",
                                            Jmax = "Jmax_medlyn",
                                            Km = "Km",
                                            leaf_respiration = "leaf_respiration",
                                            root_respiration = "root_respiration",
                                            shoot_respiration = "shoot_respiration",
                                            total_respiration_plant = "total_respiration_plant",
                                            Ca = "Ca",
                                            Qin = "Qin",
                                            VPD = "VPD",
                                            Temp = "Temp",
                                            Vcmax = "Vcmax_medlyn"),
                            leaf_area = leaf_area_12,
                            phi = 0.08,
                            time_step = 3600)
}

#Note, we will need a for loop that looks like this:
for(i in 1:length(modelled)){
  modelled[[i]][[1]]$ID <- "Medlyn"
}

ge <- list(NULL)
for(i in 1:length(modelled)){
  ge[[i]] <- modelled[[i]][[1]]
}

ge <- do.call("rbind", ge)

dailyC <- list(NULL)
for(i in 1:length(modelled)){
  dailyC[[i]] <- modelled[[i]][[1]] %>% 
    group_by(DOY, Location) %>% 
    summarize(daily_plant_C = sum(A_net_plant * 3600) * 12.01 / 1000000,
              daily_plant_photosynthesis = sum(A_gross_plant * 3600) * 12.01 / 1000000,
              daily_plant_respiration = sum(total_respiration_plant * 3600) * 12.01 / 1000000)
  dailyC[[i]]$ID <- "Medlyn"
}
dailyC <- do.call("rbind", dailyC)

modelled2 <- list(NULL)
for(i in 1:length(data_phys)){
modelled2[[i]] <- calculate_photo(data_phys = data_phys[[i]],
                            data_env = data,
                            varnames = list(GammaStar = "GammaStar",
                                            Jmax = "Jmax_new",
                                            Km = "Km",
                                            leaf_respiration = "leaf_respiration",
                                            root_respiration = "root_respiration",
                                            shoot_respiration = "shoot_respiration",
                                            total_respiration_plant = "total_respiration_plant",
                                            Ca = "Ca",
                                            Qin = "Qin",
                                            VPD = "VPD",
                                            Temp = "Temp",
                                            Vcmax = "Vcmax_new"),
                            leaf_area = leaf_area_12,
                            phi = 0.08,
                            time_step = 3600)
}
#Note, we will need a for loop that looks like this:
for(i in 1:length(modelled2)){
  modelled2[[i]][[1]]$ID <- "New"
}

ge2 <- list(NULL)
for(i in 1:length(modelled2)){
  ge2[[i]] <- modelled2[[i]][[1]]
}

ge2 <- do.call("rbind", ge2)

dailyC2 <- list(NULL)
for(i in 1:length(modelled2)){
  dailyC2[[i]] <- modelled2[[i]][[1]] %>% 
    group_by(DOY, Location) %>% 
    summarize(daily_plant_C = sum(A_net_plant * 3600) * 12.01 / 1000000,
              daily_plant_photosynthesis = sum(A_gross_plant * 3600) * 12.01 / 1000000,
              daily_plant_respiration = sum(total_respiration_plant * 3600) * 12.01 / 1000000)
  dailyC2[[i]]$ID <- "New"
}
dailyC2 <- do.call("rbind", dailyC2)

week_12_carbon_Hdfit <- rbind(dailyC, dailyC2)
week_12_ge <- rbind(ge, ge2)
boxplot(daily_plant_C ~ ID, data = week_12_carbon_Hdfit)
summary(lm(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_C ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_C-1)) #0.1% underestimation
```

#Statistics and graphical output for Week 12 (Hd fit)
#Remove octothorpe below to run chunk
#```{r include = FALSE}
# Additional column for daily plant A/R
week_12_carbon_Hdfit$daily_plant_AR <- (week_12_carbon_Hdfit$daily_plant_photosynthesis/week_12_carbon_Hdfit$daily_plant_respiration)
week_12_carbon_Hdfit$daily_plant_AR

#Stats
summary(lm(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_C ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_C))

summary(lm(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_photosynthesis ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_photosynthesis))

summary(lm(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_AR ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_AR))

#Graphs
plot(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_C ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_C,
  xlab="New Total Daily C Gain", ylab="Old Total Daily C Gain", main="b) Week 12 using Hd Fit")
abline(lm(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_C ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_C), col="blue")

plot(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_photosynthesis ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_photosynthesis,
  xlab="New Total Daily Photosynthesis", ylab="Old Total Daily Photosynthesis", main="d) Week 12 using Hd Fit")
abline(lm(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_photosynthesis ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_photosynthesis), col="blue")

plot(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_AR ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_AR,
  xlab="New Total Daily A/R", ylab="Old Total Daily A/R", main="f) Week 12 using Hd Fit")
abline(lm(week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "New",]$daily_plant_AR ~ week_12_carbon_Hdfit[week_12_carbon_Hdfit$ID == "Medlyn",]$daily_plant_AR), col="blue")
```

Merge both datasets and output
#Remove octothorpe below to run chunk
#```{r include = FALSE}
carbon <- rbind(week_1_carbon, week_12_carbon)
gasex <- rbind(week_1_ge, week_12_ge)
write.csv(carbon, "carbon_HdFit.csv")
write.csv(gasex, "gasex_HdFit.csv")
```
#Remove octothorpe below to run chunk
#```{r include = FALSE}
#More complex ggplot graphs
FigData <- read.csv(system.file("extdata", "FigModelingData.csv", 
                             package = "arrhenius.comparison"),
                 stringsAsFactors = FALSE)
                 
#Daily C Gain Graphs
W1_Hd200_CGain <- ggplot(data = FigData, aes(x = plant_C_.medlyn_W1_fix, y = plant_C_new_W1_fix)) +
  ggtitle(label = expression("b)"~"Low"~"R"~"With"~"Fixed"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.978097, intercept = 0.001426, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.3,0.3)+
  ylim(-0.3,0.3)+
  labs(x=expression('Old'~'Total'~'C'~'Gain'~"(gC"~"plant"^{-1}~"day"^{-1}*")"),
       y=expression('New'~'Total'~'C'~'Gain'~"(gC"~"plant"^{-1}~"day"^{-1}*")"))
W1_Hd200_CGain

W12_Hd200_CGain <- ggplot(data = FigData, aes(x = plant_C_medlyn_W12_fix, y = plant_C_new_W12_fix)) +
  ggtitle(label = expression("d)"~"High"~"R"~"With"~"Fixed"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.979928, intercept = 0.001377, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.3,0.3)+
  ylim(-0.3,0.3)+
  labs(x=expression('Old'~'Total'~'C'~'Gain'~"(gC"~"plant"^{-1}~"day"^{-1}*")"),
       y=expression('New'~'Total'~'C'~'Gain'~"(gC"~"plant"^{-1}~"day"^{-1}*")"))
W12_Hd200_CGain

names(FigData)
W1_HdVar_CGain <- ggplot(data = FigData, aes(x = plant_C_.medlyn_W1_var, y = plant_C_.new_W1_var)) +
  ggtitle(label = expression("a)"~"Low"~"R"~"With"~"Variable"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.983546, intercept = 0.001233, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.3,0.3)+
  ylim(-0.3,0.3)+
  labs(x=expression('Old'~'Total'~'C'~'Gain'~"(gC"~"plant"^{-1}~"day"^{-1}*")"),
       y=expression('New'~'Total'~'C'~'Gain'~"(gC"~"plant"^{-1}~"day"^{-1}*")"))
W1_HdVar_CGain

W12_HdVar_CGain <- ggplot(data = FigData, aes(x = plant_C_.medlyn_W12_var, y = plant_C_.new_W12_var)) +
  ggtitle(label = expression("c)"~"High"~"R"~"With"~"Variable"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.985405, intercept = 0.001282, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.3,0.3)+
  ylim(-0.3,0.3)+
  labs(x=expression('Old'~'Total'~'C'~'Gain'~"(gC"~"plant"^{-1}~"day"^{-1}*")"),
       y=expression('New'~'Total'~'C'~'Gain'~"(gC"~"plant"^{-1}~"day"^{-1}*")"))
W12_HdVar_CGain

library(gridExtra)
jpeg("Figure 6.jpeg", width = 7, height = 7, units = "in", res = 600)
grid.arrange(W1_HdVar_CGain, W1_Hd200_CGain, W12_HdVar_CGain, W12_Hd200_CGain,
             ncol = 2, nrow = 2)
dev.off()

## Daily Photosynthesis Across Models
names(FigData)
W1_Hd200_Photo <- ggplot(data = FigData, aes(x = photo_medlyn_W1_fix, y = photo_new_W1_fix)) +
  ggtitle(label = expression("b)"~"Low"~"R"~"With"~"Fixed"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.978097, intercept = 0.001426, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  xlim(-0.15,0.4)+
  ylim(-0.15,0.4)+
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  labs(x=expression('Old'~'Total'~'Daily'~'A'~"(gC"~"plant"^{-1}~"day"^{-1}*")"),
       y=expression('New'~'Total'~'Daily'~'A'~"(gC"~"plant"^{-1}~"day"^{-1}*")"))
W1_Hd200_Photo

W12_Hd200_Photo <- ggplot(data = FigData, aes(x = photo_medlyn_W12_fix, y = photo_new_W12_fix)) +
  ggtitle(label = expression("d)"~"High"~"R"~"With"~"Fixed"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.979928, intercept = 0.001377, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.15,0.4)+
  ylim(-0.15,0.4)+
  labs(x=expression('Old'~'Total'~'Daily'~'A'~"(gC"~"plant"^{-1}~"day"^{-1}*")"),
       y=expression('New'~'Total'~'Daily'~'A'~"(gC"~"plant"^{-1}~"day"^{-1}*")"))
W12_Hd200_Photo

names(FigData)
W1_HdVar_Photo <- ggplot(data = FigData, aes(x = photo_medlyn_W1_var, y = photo_new_W1_var)) +
  ggtitle(label = expression("a)"~"Low"~"R"~"With"~"Variable"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.983546, intercept = 0.001233, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.15,0.4)+
  ylim(-0.15,0.4)+
  labs(x=expression('Old'~'Total'~'Daily'~'A'~"(gC"~"plant"^{-1}~"day"^{-1}*")"),
       y=expression('New'~'Total'~'Daily'~'A'~"(gC"~"plant"^{-1}~"day"^{-1}*")"))
W1_HdVar_Photo

W12_HdVar_Photo <- ggplot(data = FigData, aes(x = photo_medlyn_W12_var, y = photo_new_W12_var)) +
  ggtitle(label = expression("c)"~"High"~"R"~"With"~"Variable"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.985405, intercept = 0.001282, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.15,0.4)+
  ylim(-0.15,0.4)+
  labs(x=expression('Old'~'Total'~'Daily'~'A'~"(gC"~"plant"^{-1}~"day"^{-1}*")"),
       y=expression('New'~'Total'~'Daily'~'A'~"(gC"~"plant"^{-1}~"day"^{-1}*")"))
W12_HdVar_Photo
        
library(gridExtra)
jpeg("Figure 4.jpeg", width = 7, height = 7, units = "in", res = 600)
grid.arrange(W1_HdVar_Photo, W1_Hd200_Photo, W12_HdVar_Photo, W12_Hd200_Photo,
             ncol = 2, nrow = 2)
dev.off()      

## Daily A:R
names(FigData)
W1_Hd200_AR <- ggplot(data = FigData, aes(x = AR_medlyn_W1_fix, y = AR_new_W1_fix)) +
  ggtitle(label = expression("b)"~"Low"~"R"~"With"~"Fixed"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.978097, intercept = 0.001426, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  xlim(-0.5,9.5)+
  ylim(-0.5,9.5)+
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  labs(x=expression('Old'~'Total'~'Daily'~'A/R'),
       y=expression('New'~'Total'~'Daily'~'A/R'))
W1_Hd200_AR

W12_Hd200_AR <- ggplot(data = FigData, aes(x = AR_medlyn_W12_fix, y = AR_new_W12_fix)) +
  ggtitle(label = expression("d)"~"High"~"R"~"With"~"Fixed"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.979928, intercept = 0.001377, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.5,9.5)+
  ylim(-0.5,9.5)+
  labs(x=expression('Old'~'Total'~'Daily'~'A/R'),
       y=expression('New'~'Total'~'Daily'~'A/R'))
W12_Hd200_AR

W1_HdVar_AR <- ggplot(data = FigData, aes(x = AR_medlyn_W1_var, y = AR_new_W1_var)) +
  ggtitle(label = expression("a)"~"Low"~"R"~"With"~"Variable"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.983546, intercept = 0.001233, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.5,9.5)+
  ylim(-0.5,9.5)+
  labs(x=expression('Old'~'Total'~'Daily'~'A/R'),
       y=expression('New'~'Total'~'Daily'~'A/R'))
W1_HdVar_AR

W12_HdVar_AR <- ggplot(data = FigData, aes(x = AR_medlyn_W12_var, y = AR_new_W12_var)) +
  ggtitle(label = expression("c)"~"High"~"R"~"With"~"Variable"~H[d])) +
  geom_point(size = 3, alpha = 0.7)+
  geom_abline(slope = 1, intercept = 0, size = 1, colour = "Black") +
  geom_abline(slope = 0.985405, intercept = 0.001282, size = 2, linetype = "dashed", colour = "Gray45")+
  theme_bw() +
  theme(panel.grid = element_blank())+
  theme(text = element_text(size = 12, colour = "Black"),
        axis.line=element_line(size=1), axis.ticks=element_line(size=1.5),
        axis.ticks.length=unit(1.5, "mm"), rect=element_rect(size=2))+
  xlim(-0.5,9.5)+
  ylim(-0.5,9.5)+
  labs(x=expression('Old'~'Total'~'Daily'~'A/R'),
       y=expression('New'~'Total'~'Daily'~'A/R'))
W12_HdVar_AR

library(gridExtra)
jpeg("Figure 5.jpeg", width = 7.5, height = 7.5, units = "in", res = 600)
grid.arrange(W1_HdVar_AR, W1_Hd200_AR, W12_HdVar_AR, W12_Hd200_AR,
             ncol = 2, nrow = 2)
dev.off()   
<<<<<<< HEAD

## Compound interest comparsions
#Initial biomass of 1g
#180 day growing season
#Lowest % difference = 1.5% for week 12 fitted
Medlyn = 0.0563 gC plant-1 day-1
New = 0.0558 gC plant-1 day-1

#Daily Interest
FV <- PV*((1+i)^n

FV = (1)*(1+(0.0558))^180
FV

Med <- 0.0558*180 = 10.044 g + 1 g = 11.044 g 
New <- 0.0563*180 = 10.134 g + 1 g = 11.134 g 
Diff <- <1% (0.815%)

#Compound Interest
P=1
n=180
R1=(0.0558)
R2=(0.0563)

A1=(P*(1+(R1/1))^n)
A2=(P*(1+(R2/1))^n)
A1
A2

Diff=((A2-A1)/((A1+A2)/2))*100
Diff





=======
```
>>>>>>> 1a689f9231e4e8257d522c97bfa2792ed2884f6d
